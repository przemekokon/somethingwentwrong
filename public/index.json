[{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\u003c/h3\u003e\n\u003ch1 id=\"summary\"\u003eSummary\u003c/h1\u003e\n\u003cp\u003eEmails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy. \n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\u003c/h3\u003e\n\u003ch1 id=\"summary\"\u003eSummary\u003c/h1\u003e\n\u003cp\u003eEmails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\u003c/h3\u003e\n\u003ch1 id=\"summary\"\u003eSummary\u003c/h1\u003e\n\u003cp\u003eEmails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\naa Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details aaa Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nidk some flow description\nidk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text:\n{ \u0026ldquo;CatalogTaskNumber\u0026rdquo;: \u0026ldquo;extracted SCTASK number or null\u0026rdquo;, \u0026ldquo;RequestType\u0026rdquo;: \u0026ldquo;DL or GroupMailbox\u0026rdquo;, \u0026ldquo;DLName\u0026rdquo;: \u0026ldquo;name of distribution list if RequestType is DL, otherwise null\u0026rdquo;, \u0026ldquo;MailboxAddress\u0026rdquo;: \u0026ldquo;email address if RequestType is GroupMailbox, otherwise null\u0026rdquo; }\nRules:\nRequestType must be exactly \u0026ldquo;DL\u0026rdquo; or \u0026ldquo;GroupMailbox\u0026rdquo; based on the request DLName can be either a name or an address Return only valid JSON, no markdown, no explanation email Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Add a random test content few times, if you will have expected results every time - you are good to go Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Summary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Add a random test content few times, if you will have expected results every time - you are good to go Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Parse JSON idk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Add a random test content few times, if you will have expected results every time - you are good to go Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Parse JSON Content is a Text from Prompt dynamic output (it\u0026rsquo;s basically a response) Schema could be built by clickin on Use sample payload.. and adding a test output idk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Add a random test content few times, if you will have expected results every time - you are good to go Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Parse JSON Content is a Text from Prompt dynamic output (it\u0026rsquo;s basically a response) Schema could be built by clickin on Use sample payload.. and adding a test output we got below. I also like to be able to work with null data as in my case there is such possibility and for JSON empty string doesn\u0026rsquo;t equal a null string idk some flow description\nAdd a row into a table idk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\nGeneral flow describtion Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new now into SharedMailboxes sheet idk some flow description\nSome Details When a new email arrives (V3) Like I wrote, it\u0026rsquo;s a good idea to either filter emails on the mailbox side (inbox rule) or we can filter these on the flow itself (but PA offers less creative ways - just basic staff like TO, FROM, subject).\nIt\u0026rsquo;s easier to just check for all emails in a specific mailbox folder:\nidk some flow description\nHTML to text Not much to say - just add an email body in here.\nidk some flow description\nRun a prompt The most important and tricky part of the Flow.\nIt could be a seperate note for this part, so let me add some major points here:\nPrompt has two parts a. Prompt itself (what we want) b. Data source (in our example - an email Body - from HTML to text step) Instructions must be as strict as possible By default a mini AI model is choosen - I recommend to use a standard one Add content button is in fact add a source - I just use text for an input, the source name is shown as Email on the above screenshot Add a random test content few times, if you will have expected results every time - you are good to go Output should be JSON - as it\u0026rsquo;s structurized idk some flow description\nidk some flow description\nA full prompt example I use:\nBased on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation email Parse JSON Content is a Text from Prompt dynamic output (it\u0026rsquo;s basically a response) Schema could be built by clickin on Use sample payload.. and adding a test output we got below. I also like to be able to work with null data as in my case there is such possibility and for JSON empty string doesn\u0026rsquo;t equal a null string idk some flow description\nAdd a row into a table At the end you just add entries from JSON into Excel table\nidk some flow description\nBonus - Switch In my scenario, I\u0026rsquo;m using switch to write data into two different sheets - basically, my switch is based on JSON - request type, if it\u0026rsquo;s a DL - go into DL excel, if GroupMailbox (it\u0026rsquo;s a case sensitive I belive) - go to apopriate sheet.\nSwitch is based on \u0026lsquo;body(\u0026lsquo;Parse_JSON\u0026rsquo;)?[\u0026lsquo;RequestType\u0026rsquo;]\u0026rsquo; and cases are mentioned DL and GroupMailbox\nidk some flow description\nSummary Emails can be easily accessed using PowerAutomate, Excel tables can be easily written using PowerAutomate. The issue starts when a specific part of an email should be written into Excel - REGEX would be helpful, if supported.\nHere is where AI can be handy.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor emails from a ticketing system for certain types of emails, that\u0026rsquo;s where PowerAutomate can do all the boring stuff.\u003c/p\u003e\n\u003ch2 id=\"general-flow-describtion\"\u003eGeneral flow describtion\u003c/h2\u003e\n\u003cp\u003eFlow has steps listed below:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet an email from a specific mailbox folder (emails get there via inbox rule)\u003c/li\u003e\n\u003cli\u003eConvert HTML (email body) into TEXT (for raw output)\u003c/li\u003e\n\u003cli\u003eRun a prompt to get a specific info from email\u003c/li\u003e\n\u003cli\u003eSave a prompt output into JSON to easily proceed\u003c/li\u003e\n\u003cli\u003eIn my scenario I use switch as I work on two types of emails\u003c/li\u003e\n\u003cli\u003eIf email is about DL - save a new row into DL sheet\u003c/li\u003e\n\u003cli\u003eIf email is about a shared mailbox - save a new now into SharedMailboxes sheet\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/flow_general.png\"\r\n          alt=\"pa flow\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eidk some flow description\u003c/p\u003e","title":"Parse data using AI-Prompt instead of REGEX in PowerAutomate"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do [A-Z]{5,7}\\d{7} to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nThe Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003cp\u003eI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do \u003ccode\u003e[A-Z]{5,7}\\d{7}\u003c/code\u003e to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do [A-Z]{5,7}\\d{7} to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nThe Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003cp\u003eI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do \u003ccode\u003e[A-Z]{5,7}\\d{7}\u003c/code\u003e to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nThe Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nThe Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nThe Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do [A-Z]{5,7}\\d{7} to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nGeneral flow description Flow has steps listed below:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get a specific info from email Save a prompt output into JSON to easily proceed In my scenario I use switch as I work on two types of emails If email is about DL - save a new row into DL sheet If email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003cp\u003eI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do \u003ccode\u003e[A-Z]{5,7}\\d{7}\u003c/code\u003e to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do [A-Z]{5,7}\\d{7} to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003cp\u003eI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do \u003ccode\u003e[A-Z]{5,7}\\d{7}\u003c/code\u003e to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem So here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do [A-Z]{5,7}\\d{7} to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eSo here\u0026rsquo;s the situation: I need to monitor a shared mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003cp\u003eI know, I know. It\u0026rsquo;s 2026 and we still can\u0026rsquo;t do \u003ccode\u003e[A-Z]{5,7}\\d{7}\u003c/code\u003e to grab a ticket number. Microsoft, if you\u0026rsquo;re reading this - please fix this. Thanks.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Instead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003eInstead of fighting the platform, I decided to throw AI at the problem. Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. It mostly is. With a few gotchas along the way (hence the blog name).\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy.\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy. What could go wrong?\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy. What could go wrong?\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data Sounds easy.\nGeneral flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSounds easy.\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a shared mailbox - save a new row into SharedMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet me break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things I learned:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard gives more consistent results. Worth the extra tokens.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where I hit my first real issue.\nPower Automate\u0026rsquo;s \u0026ldquo;Run a prompt\u0026rdquo; action exposes parsed fields in dynamic content when you use JSON output mode. Great! Except\u0026hellip; sometimes those fields are null even when the JSON clearly contains the value.\nI spent way too long debugging why RequestType was null for GroupMailbox emails but worked fine for DL emails. The JSON in the response was correct both times.\nThe fix: Don\u0026rsquo;t trust the automatic structured output. Add a \u0026ldquo;Parse JSON\u0026rdquo; action and use the raw Text field from the prompt response.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse\u0026hellip; JSON with JSON?\nGood question. I asked myself the same thing.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails? RequestType was null. Even though the raw JSON response clearly had the correct value.\nI spent way too long debugging this. The JSON was identical in structure. The values were there. But Power Automate\u0026rsquo;s automatic parsing just\u0026hellip; didn\u0026rsquo;t work for one type.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling. Suddenly everything works.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question. I asked myself the same thing.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails? RequestType was null. Even though the raw JSON response clearly had the correct value.\nI spent way too long debugging this. The JSON was identical in structure. The values were there. But Power Automate\u0026rsquo;s automatic parsing just\u0026hellip; didn\u0026rsquo;t work for one type.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling. Suddenly everything works.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails? RequestType was null. Even though the raw JSON response clearly had the correct value.\nI spent way too long debugging this. The JSON was identical in structure. The values were there. But Power Automate\u0026rsquo;s automatic parsing just\u0026hellip; didn\u0026rsquo;t work for one type.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling. Suddenly everything works.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nI spent way too long debugging this. The JSON was identical in structure. The values were there. But Power Automate\u0026rsquo;s automatic parsing just\u0026hellip; didn\u0026rsquo;t work for one type.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling. Suddenly everything works.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling. Suddenly everything works.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: outputs('Run_a_prompt')?['body/responsev2/predictionOutput/Text']\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support - important!):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } Switch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nWhat I Learned AI prompt output can be inconsistent - the \u0026ldquo;structured output\u0026rdquo; feature in Power Automate is convenient but not 100% reliable. Parse JSON yourself for critical flows.\nBe explicit in your prompts - \u0026ldquo;Return ONLY JSON\u0026rdquo; means nothing if you don\u0026rsquo;t also say \u0026ldquo;no markdown, no explanation, no extra text\u0026rdquo;.\nTest with edge cases - different email formats, missing data, weird characters. AI will surprise you.\nJSON null handling matters - use [\u0026quot;string\u0026quot;, \u0026quot;null\u0026quot;] in your schema, not just \u0026quot;string\u0026quot;.\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Power Automate can\u0026rsquo;t regex. But it can call AI. And AI can regex better than regex can regex (don\u0026rsquo;t quote me on that).\nFor parsing semi-structured email content, the AI prompt approach works surprisingly well. Just don\u0026rsquo;t trust the automatic structured output parsing - do it yourself with Parse JSON.\nTotal setup time: about 30 minutes once you know the gotchas.\nTime saved per email: 2-3 minutes of manual copy-paste.\nWorth it? Absolutely.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:58330/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"The Problem ","permalink":"http://localhost:58330/posts/ext_att_group_graph/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:58330/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:58330/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:58330/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:58330/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:58330/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Hello there, Something went wrong and I became an engineer instead of a nepo baby.\nSometimes I document here some of the problems that made me question my life choices.\nContact Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post? See that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR. Or just write me an email, I like emails.\n","permalink":"http://localhost:58330/about/","summary":"Who writes this and why","title":"About"}]