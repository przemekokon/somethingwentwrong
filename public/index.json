[{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"","title":"New_azure_ext_attribute"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"This post describes the step-by-step process of creating and configuring Entra ID Extension Attributes  custom properties that can be added to directory objects such as users or groups to store additional metadata beyond the standard schema.\n1. Create an Application Registration Application Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eThis post describes the step-by-step process of creating and configuring Entra ID Extension Attributes  custom properties that can be added to directory objects such as users or groups to store additional metadata beyond the standard schema.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eThis is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\u003c/p\u003e","title":"Creating and configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch. That is exactly what Extension Attributes are for.\n1. Create an Application Registration Application Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch. That is exactly what Extension Attributes are for.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\u003c/p\u003e","title":"Creating and configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\u003c/p\u003e","title":"Creating and configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration serves as a namespace for your extension attributes  it defines what attributes exist and on which object types they can be used.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration serves as a namespace for your extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration serves as a namespace for your extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eThis is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for your extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for your extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eThis is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal This is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\nThe following extension properties are not available: extension_\u0026lt;id\u0026gt;_\u0026lt;name\u0026gt; 1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eThis is a critical step that is often overlooked. Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant. Attempting to set an attribute without this step will result in the following error:\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used  the application exists only as a definition, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding.\n3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId Note: After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding. 3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId Note: After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding. 3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId Note: After creating the Service Principal, wait a moment for Azure to propagate the changes across the tenant before proceeding. 3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 $app = New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 $sp = New-MgServicePrincipal -AppId $app.AppId 3. Create an Extension Property 1 $ext = New-MgApplicationExtensionProperty -ApplicationId $app.Id -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId $app.Id | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 Or as a one-liner using the $ext variable from step 3:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter @{($ext.Name) = \u0026#34;Sample Value\u0026#34;} 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 3. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us  mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-a-service-principal\"\u003e2. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help understand what goes where Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous: if you need to store custom metadata on users or groups, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft 7. Image could help understand what goes where Extension Attribute value visible in group AdditionalProperties\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\n","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 3\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization. ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 3\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values. Step 3\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization. ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 3\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Exchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration as a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property 1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 2\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eExchange has spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration as a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Microsoft Exchange spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration works s a namespace for an extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property Now we create an attribute itself.\n1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 2\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eMicrosoft Exchange spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration works s a namespace for an extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cp\u003eNow we create an attribute itself.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"},{"content":"Microsoft Exchange spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\n1. Create an Application Registration Application Registration works as the namespace for extension attributes.\n1 New-MgApplication -DisplayName \u0026#34;Extension Attribute Sample Application\u0026#34; -SignInAudience AzureADMyOrg 2. Create an Extension Property Now we create an attribute itself.\n1 New-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; -Name \u0026#34;Att1\u0026#34; -DataType String -TargetObjects @(\u0026#34;Group\u0026#34;) 3. Create a Service Principal Without a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\n1 New-MgServicePrincipal -AppId \u0026lt;AppId\u0026gt; 4. Verify the Extension Property 1 Get-MgApplicationExtensionProperty -ApplicationId \u0026lt;Id\u0026gt; | ft Name The extension attribute name follows this convention:\nextension_{ServicePrincipalObjectIdWithoutHyphens}_{AttributeName} Example:\nextension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 5. Set the Attribute on a Group Prepare the body parameter using the full extension attribute name:\n1 $att1 = @{extension_0bff5cf1c92f438e95aaab5fc59c0743_Att1 = \u0026#34;Sample Value\u0026#34;} Update the group:\n1 Update-MgGroup -GroupId \u0026lt;GroupId\u0026gt; -BodyParameter $att1 6. Verify the Result 1 (Get-MgGroup -GroupId \u0026lt;GroupId\u0026gt;).AdditionalProperties | ft How it all fits together The arrows show how Application ID and AppId flow through the subsequent commands\nNotes After creating the Service Principal, wait a few minutes for sync, before attempting to set any attribute values Step 2\u0026rsquo;s -TargetObjects parameter supports multiple object types: User, Group, AdministrativeUnit, Application, Device, and Organization ","permalink":"http://localhost:1313/posts/new_azure_ext_attribute/","summary":"\u003cp\u003eMicrosoft Exchange spoiled us - mail-enabled objects always had a set of custom attributes ready to use out of the box. Entra ID is less generous, you have to extend the schema yourself from scratch.\u003c/p\u003e\n\u003ch2 id=\"1-create-an-application-registration\"\u003e1. Create an Application Registration\u003c/h2\u003e\n\u003cp\u003eApplication Registration works as the namespace for extension attributes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplication\u003c/span\u003e \u003cspan class=\"n\"\u003e-DisplayName\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Extension Attribute Sample Application\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-SignInAudience\u003c/span\u003e \u003cspan class=\"n\"\u003eAzureADMyOrg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"2-create-an-extension-property\"\u003e2. Create an Extension Property\u003c/h2\u003e\n\u003cp\u003eNow we create an attribute itself.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eNew-MgApplicationExtensionProperty\u003c/span\u003e \u003cspan class=\"n\"\u003e-ApplicationId\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eId\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Att1\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-DataType\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003e-TargetObjects\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Group\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"3-create-a-service-principal\"\u003e3. Create a Service Principal\u003c/h2\u003e\n\u003cp\u003eWithout a Service Principal, the extension attributes are defined but cannot be used - the application exists only as a \u0026lsquo;definition\u0026rsquo;, not as an active entity in your tenant.\u003c/p\u003e","title":"Creating and Configuring Entra Extension Attributes"},{"content":"Introduction When working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\nThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\nThe Goal In this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\nTarget: Important file about cats\nBefore You Start Important: To follow this guide, you need one of these permissions:\nGlobal Administrator role in Microsoft 365 Site Owner/Admin permissions for the specific SharePoint site (not SharePoint Administrator role) 1. Get the SharePoint Site ID First, we need the Site ID. There are several ways to obtain this, here is my favorite method:\nAdd _api/site/id to your SharePoint site URL\nFor example, my site is:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing I navigate to:\nhttps://wst3j.sharepoint.com/sites/SalesandMarketing/_api/site/id The response is in JSON format and the value in the Edm.Guid property is the Site ID.\nUsing the SharePoint REST API to get Site ID\n2. Get the Drive ID Now that we have the Site ID, we\u0026rsquo;ll use Microsoft Graph Explorer to find the Drive ID.\nNavigate to Graph Explorer Make sure you\u0026rsquo;re logged in with appropriate permissions Run this query (replace \u0026lt;Site_ID\u0026gt; with your actual Site ID): https://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives?$select=name,id Using $select filter to get only name and id properties\nThe response will contain the Drive ID(s) for your SharePoint site.\n3. Navigate the Folder Structure With both the Site ID and Drive ID, we can now navigate through the folder hierarchy to find our file.\nList Root Folder Contents Start by listing the root folder contents:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/root/children This returns all items in the root of your SharePoint document library:\nRoot folder items with their IDs\nThe same folders as seen in SharePoint interface\nNavigate to Subfolders In our example, the file is located under Marketing, so we\u0026rsquo;ll navigate there next using the folder\u0026rsquo;s ID from the previous response:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Marketing_Folder_ID\u0026gt;/children Contents of the Marketing folder\nThe same folder via GUI\nContinue Navigating We continue this process, replacing the folder ID in the URL as we go deeper:\nNext level - Cat Pictures folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Cat_Pictures_Folder_ID\u0026gt;/children Getting closer to our target file\nFinal level - Kitties folder:\nhttps://graph.microsoft.com/v1.0/sites/\u0026lt;Site_ID\u0026gt;/drives/\u0026lt;Drive_ID\u0026gt;/items/\u0026lt;Kitties_Folder_ID\u0026gt;/children Found it! Our Excel file with its ID\nUsing the File ID Once you have the file information from the API response, you can use either:\nid - The unique identifier for Graph API operations webUrl - The direct web URL to the file Both can be used in subsequent Graph API calls to interact with the file (read, write, update, etc.).\nSummary The process to get a SharePoint item ID involves:\nObtaining the Site ID using _api/site/id Getting the Drive ID via Graph API Navigating the folder hierarchy step-by-step using the children endpoint Extracting the final file ID from the response ","permalink":"http://localhost:1313/posts/get_sp_item_id/","summary":"\u003ch2 id=\"introduction\"\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eWhen working with Microsoft Graph API to automate SharePoint operations (like writing script outputs, saving reports, updating Excel files), we can\u0026rsquo;t just use file paths. We need to work with unique identifiers - specifically - the file ID.\u003c/p\u003e\n\u003cp\u003eThis guide walks you through the process of finding a SharePoint item ID by navigating the site hierarchy using Graph API Explorer.\u003c/p\u003e\n\u003ch2 id=\"the-goal\"\u003eThe Goal\u003c/h2\u003e\n\u003cp\u003eIn this example, we\u0026rsquo;ll find the ID of an Excel file located deep within a SharePoint site structure:\u003c/p\u003e","title":"How to Get SharePoint Item ID Using Microsoft Graph API"},{"content":"Get-GroupMemberReport PowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns transitive (recursive) member counts - including all nested group members.\nWhy? Get-DistributionGroupMember only returns direct members, not nested Exchange Online cmdlets have pagination timeouts on large tenants Graph API\u0026rsquo;s Get-MgGroupTransitiveMemberCount solves both problems Requirements PowerShell 5.1+ or PowerShell 7+ Microsoft Graph PowerShell SDK Permissions: Group.Read.All, Directory.Read.All Usage 1 2 3 4 5 6 7 8 9 10 11 # Distribution Lists only .\\Get-GroupMemberReport.ps1 -DL # Microsoft 365 Groups only .\\Get-GroupMemberReport.ps1 -M365 # Both types .\\Get-GroupMemberReport.ps1 -All # Test mode - first ~100 DLs or M365 .\\Get-GroupMemberReport.ps1 -DL/M365 -TestLimit 100 Output CSV file with columns:\nColumn Description PrimarySmtpAddress Group email address DisplayName Group display name GroupType DL or M365 Members Total recursive member count Empty yes if 0 members Size_1_10 yes if 1-10 members Size_11_100 yes if 11-100 members \u0026hellip; etc. Size buckets make it easy to filter and analyze DL distribution in Excel.\nHow it works Fetches mail-enabled groups via Graph API Filters by groupTypes property ([] = DL, [\u0026quot;Unified\u0026quot;] = M365) Calls Get-MgGroupTransitiveMemberCount for each group Exports results with size category flags Get the script Full source code with usage examples: GitHub\n","permalink":"http://localhost:1313/posts/dls_members_count/","summary":"\u003ch1 id=\"get-groupmemberreport\"\u003eGet-GroupMemberReport\u003c/h1\u003e\n\u003cp\u003ePowerShell script to audit Distribution Lists and Microsoft 365 Groups membership using Microsoft Graph API. Returns \u003cstrong\u003etransitive (recursive) member counts\u003c/strong\u003e - including all nested group members.\u003c/p\u003e\n\u003ch2 id=\"why\"\u003eWhy?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eGet-DistributionGroupMember\u003c/code\u003e only returns direct members, not nested\u003c/li\u003e\n\u003cli\u003eExchange Online cmdlets have pagination timeouts on large tenants\u003c/li\u003e\n\u003cli\u003eGraph API\u0026rsquo;s \u003ccode\u003eGet-MgGroupTransitiveMemberCount\u003c/code\u003e solves both problems\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"requirements\"\u003eRequirements\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ePowerShell 5.1+ or PowerShell 7+\u003c/li\u003e\n\u003cli\u003eMicrosoft Graph PowerShell SDK\u003c/li\u003e\n\u003cli\u003ePermissions: \u003ccode\u003eGroup.Read.All\u003c/code\u003e, \u003ccode\u003eDirectory.Read.All\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Distribution Lists only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Microsoft 365 Groups only  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Both types\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-All\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# Test mode - first ~100 DLs or M365\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"nb\"\u003eGet-GroupMemberReport\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eps1\u003c/span\u003e \u003cspan class=\"n\"\u003e-DL\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eM365\u003c/span\u003e \u003cspan class=\"n\"\u003e-TestLimit\u003c/span\u003e \u003cspan class=\"mf\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"output\"\u003eOutput\u003c/h2\u003e\n\u003cp\u003eCSV file with columns:\u003c/p\u003e","title":"Recursive Member Count for Distribution Lists"},{"content":"Problem I need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\nThe catch? Power Automate doesn\u0026rsquo;t support regex.\nThe Workaround Power Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\nThe idea is simple:\nGet the email Feed it to AI with instructions Get structured JSON back Do whatever you want with clean data General flow description The flow has the following steps:\nGet an email from a specific mailbox folder (emails get there via inbox rule) Convert HTML (email body) into TEXT (for raw output) Run a prompt to get specific info from the email Save the prompt output into JSON to easily proceed In my scenario I use a switch as I work with two types of emails If the email is about DL - save a new row into DL sheet If the email is about a group mailbox - save a new row into GroupMailboxes sheet The Flow Here\u0026rsquo;s the general structure:\nThe full flow - nothing too crazy\nLet\u0026rsquo;s break down each step.\nWhen a new email arrives (V3) I have an inbox rule that moves specific emails to a dedicated folder. The flow just monitors that folder.\nYou could also filter directly in Power Automate using subject/from conditions, but inbox rules give you more flexibility.\nMonitoring a specific folder keeps things clean\nHTML to text Email bodies are HTML. AI works better with plain text. This step does the conversion.\nJust pass the email body - nothing fancy\nRun a prompt This is where the magic happens. A few important things to follow:\nThe prompt needs to be strict. AI loves to be helpful and chatty. You don\u0026rsquo;t want \u0026ldquo;Here are the extracted values based on your email content:\u0026rdquo;. You want just the JSON.\nUse JSON output mode. There\u0026rsquo;s an \u0026ldquo;Output: JSON\u0026rdquo; setting in the prompt configuration. Use it. This makes Power Automate automatically parse the response into structured fields.\nUse the standard model, not mini. Mini works, but standard works better.\nAdd content = data source. The \u0026ldquo;Add content\u0026rdquo; button is where you connect your input data. In my case, it\u0026rsquo;s the plain text email body from the previous step.\nTest multiple times. AI can be\u0026hellip; creative. Run your prompt with different test inputs before going live.\nThe prompt action with JSON output enabled\nI recommend using the standard model, not mini\nHere\u0026rsquo;s the prompt I ended up with:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Based on the email content, extract the following information and return ONLY a JSON object with no additional text: { \u0026#34;CatalogTaskNumber\u0026#34;: \u0026#34;extracted SCTASK number or null\u0026#34;, \u0026#34;RequestType\u0026#34;: \u0026#34;DL or GroupMailbox\u0026#34;, \u0026#34;DLName\u0026#34;: \u0026#34;name of distribution list if RequestType is DL, otherwise null\u0026#34;, \u0026#34;MailboxAddress\u0026#34;: \u0026#34;email address if RequestType is GroupMailbox, otherwise null\u0026#34; } Rules: - RequestType must be exactly \u0026#34;DL\u0026#34; or \u0026#34;GroupMailbox\u0026#34; based on the request - DLName can be either a name or an address - Return only valid JSON, no markdown, no explanation Parse JSON Here\u0026rsquo;s where it gets weird.\nSo the prompt already returns JSON. And Power Automate parses it automatically when you use JSON output mode. So why would you add another \u0026ldquo;Parse JSON\u0026rdquo; action to parse.. JSON with JSON?\nGood question.\nBut here\u0026rsquo;s what happened: the automatic parsing worked fine for DL emails. For GroupMailbox emails RequestType was null. Even though the raw JSON response clearly had the correct value.\nThe fix: Add a \u0026ldquo;Parse JSON\u0026rdquo; action manually and use the raw Text field from the prompt response. Define your own schema with proper null handling.\nParse the Text output, not the structured fields\nFor content, use: \u0026lsquo;Text\u0026rsquo; - basically a prompt response.\nSchema (with null support):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;CatalogTaskNumber\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;RequestType\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;DLName\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] }, \u0026#34;MailboxAddress\u0026#34;: { \u0026#34;type\u0026#34;: [\u0026#34;string\u0026#34;, \u0026#34;null\u0026#34;] } } } You can build your own schema based on output from the prompt and using sample payload to generate it.\nSwitch In my case, I have two types of requests that need to go to different Excel files. The Switch action handles this based on RequestType.\nDL goes one way, GroupMailbox goes another\nImportant: Use the expression body('Parse_JSON')?['RequestType'] - not just body('Parse_JSON') (that returns the whole object and Switch will complain about expecting a string).\nThe cases are DL and GroupMailbox - case-sensitive, so make sure your prompt returns exactly these values.\nAdd a row into a table Standard Excel action. Map the JSON fields to your table columns.\nJSON fields map directly to Excel columns\nSummary Emails can be easily accessed using Power Automate. Excel tables can be easily written using Power Automate. The issue starts when a specific part of an email should be written into Excel - regex would be helpful, if supported.\nIt\u0026rsquo;s even quite funny, we got a working AI in Power Automate faster than regex support..\n","permalink":"http://localhost:1313/posts/power_automate_ai/","summary":"\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI need to monitor my mailbox for certain ticket emails and extract specific data from them. Classic automation stuff.\u003c/p\u003e\n\u003cp\u003eThe catch? Power Automate doesn\u0026rsquo;t support regex.\u003c/p\u003e\n\u003ch2 id=\"the-workaround\"\u003eThe Workaround\u003c/h2\u003e\n\u003cp\u003ePower Automate has this \u0026ldquo;Run a prompt\u0026rdquo; action that lets you use GPT to process text.\u003c/p\u003e\n\u003cp\u003eThe idea is simple:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGet the email\u003c/li\u003e\n\u003cli\u003eFeed it to AI with instructions\u003c/li\u003e\n\u003cli\u003eGet structured JSON back\u003c/li\u003e\n\u003cli\u003eDo whatever you want with clean data\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"general-flow-description\"\u003eGeneral flow description\u003c/h2\u003e\n\u003cp\u003eThe flow has the following steps:\u003c/p\u003e","title":"When PowerAutomate Can't Regex - Let AI Do The Parsing"},{"content":"Add:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -AddLicenses @{SkuID = \u0026#39;2ced8a00...\u0026#39;} -RemoveLicenses @()} Remove:\n1 Get-Content \u0026lt;file path\u0026gt; | foreach {Set-MgUserLicense -UserId $_ -RemoveLicenses @(\u0026#39;3db7c7ead579...\u0026#39;) -AddLicenses @{}} Check for a license SkuId:\nGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;orGet-MgSubscribedSku | fl SkuPartNumber, skuid\nFile path is a TXT file containing UPNs one-per-line. ","permalink":"http://localhost:1313/posts/license_assign_graph/","summary":"\u003cp\u003eAdd:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eSkuID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;2ced8a00...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eRemove:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eSet-MgUserLicense\u003c/span\u003e \u003cspan class=\"n\"\u003e-UserId\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e \u003cspan class=\"n\"\u003e-RemoveLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;3db7c7ead579...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003e-AddLicenses\u003c/span\u003e \u003cspan class=\"vm\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eCheck for a license SkuId:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGet-MgUserLicenseDetail -UserId \u0026lt;UPN\u0026gt;\u003c/code\u003eor\u003ccode\u003eGet-MgSubscribedSku | fl SkuPartNumber, skuid\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFile path is a TXT file containing UPNs one-per-line.\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign licenses in bulk via Graph API"},{"content":"The Problem Classic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\nGetting slapped in the face with error\nThe Solution Two words: Graph API.\nStep 1: Get the Mail Contact ID First, we need to identify the exact object we\u0026rsquo;re dealing with:\n1 Get-MailContact lorem.ipsum@contoso.com | Format-List Id This will give the unique identifier for the mail contact.\nStep 2: Verify the Object in Graph API Better safe than sorry- let\u0026rsquo;s do a double check. Replace \u0026lt;ID\u0026gt; with the ID from Step 1:\n1 Invoke-MgGraphRequest -Method GET -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; -OutputType PSObject Review the output to confirm this is indeed the object you want to remove.\nStep 3: Force Delete via Graph API Exterminate.\n1 Invoke-MgGraphRequest -Method DELETE -Uri \u0026#34;https://graph.microsoft.com/beta/directoryObjects/\u0026lt;ID\u0026gt;\u0026#34; More or Less Important Notes Graph API deletions are immediate - there\u0026rsquo;s no confirmation prompt, so triple-check that ID Here is how a sample uri looks like: URI - not URL (uniform resource identifier) Summary Someday we will get Remove-MgContact but today is not the day. We must use a workaround.\n","permalink":"http://localhost:1313/posts/mail_contact_delete/","summary":"\u003ch2 id=\"the-problem\"\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eClassic Exchange Online scenario - trying to remove an orphaned (maybe used to be synced) object.\u003c/p\u003e\n\u003cfigure\u003e\r\n    \u003cimg loading=\"lazy\" src=\"/images/contact_removal_error.png\"\r\n         alt=\"Error message when trying to remove contact\"/\u003e \u003cfigcaption\u003e\r\n            \u003cp\u003eGetting slapped in the face with error\u003c/p\u003e\r\n        \u003c/figcaption\u003e\r\n\u003c/figure\u003e\r\n\n\u003ch2 id=\"the-solution\"\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eTwo words: Graph API.\u003c/p\u003e\n\u003ch3 id=\"step-1-get-the-mail-contact-id\"\u003eStep 1: Get the Mail Contact ID\u003c/h3\u003e\n\u003cp\u003eFirst, we need to identify the exact object we\u0026rsquo;re dealing with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-MailContact\u003c/span\u003e \u003cspan class=\"n\"\u003elorem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eipsum\u003c/span\u003e\u003cspan class=\"nv\"\u003e@contoso\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecom\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eFormat-List\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eThis will give the unique identifier for the mail contact.\u003c/p\u003e\n\u003ch3 id=\"step-2-verify-the-object-in-graph-api\"\u003eStep 2: Verify the Object in Graph API\u003c/h3\u003e\n\u003cp\u003eBetter safe than sorry- let\u0026rsquo;s do a double check. Replace \u003ccode\u003e\u0026lt;ID\u0026gt;\u003c/code\u003e with the ID from Step 1:\u003c/p\u003e","title":"Force Removal Orphaned Contact in Microsoft 365"},{"content":"Permissions Consent Pop-up Every new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\nApp permissions consent pop-up\nIn most scenarios, this pop-up can be bypassed.\nHiding consent pop-up This requries a single PowerShell command:\n1 Set-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] Expected result: BypassConsent flag is set\nWe can get guids using PowerShell:\nEnvironment GUID:\n1 Get-AdminPowerAppEnvironment [\u0026#39;Environment Display Name\u0026#39;] | Select EnvironmentName App GUID:\n1 Get-AdminPowerApp [\u0026#39;App Display Name\u0026#39;] -EnvironmentName [Guid] | Select AppName What happens under the hood? After the command runs successfully, the BypassConsent flag is set to True for the app.\nIf the connector meets certain criteria (listed below), the app assumes consent is granted.\nThis does NOT grant tenant-level delegated access (like an Entra registered app). If a user lacks permissions to access data, the app still denies access.\nIn short: The app behaves as the user already clicked \u0026ldquo;Allow\u0026rdquo;.\nConsent bypassing criteria:\nWorks only for Microsoft connectors (except..) Does not work for Entra and Azure DevOps connectors Does not work for third-party connectors (like Slack or Smartsheet) Connectors must use OAuth or No Auth Power Automate flows require separate consent Bypassing consent for the PowerApp does not automatically handle Power Automate flows triggered from the app.\nWhat happens:\nThe app works correctly (displays data, buttons respond) App shows flow related errors Flow audit log shows authentication/connection failures Why this occurs:\nPower Apps and Power Automate have separate consent mechanisms Flows execute in the user\u0026rsquo;s context and require their own connection references Each user needs established connections to the connectors used in flows (Sending E-mails, Approvals etc.) Bypassing app consent doesn\u0026rsquo;t create these flow connections automatically This is a separate configuration challenge that requires additional setup beyond the app consent bypass. It will be covered in another blog post.\nNotes These commands are available in module: Microsoft.PowerApps.Administration.PowerShell Command reversing this setting is 1 Clear-AdminPowerAppApisToBypassConsent -EnvironmentName [Guid] -AppName [Guid] After connector changes, updates, or major logic updates, it\u0026rsquo;s good practice to reset the BypassConsent flag Summary Use Set-AdminPowerAppApisToBypassConsent to hide consent pop-ups.\nThis doesn\u0026rsquo;t change permissions - just removes the prompt.\n","permalink":"http://localhost:1313/posts/power_apps_consent/","summary":"\u003ch2 id=\"permissions-consent-pop-up\"\u003ePermissions Consent Pop-up\u003c/h2\u003e\n\u003cp\u003eEvery new user must approve permissions when accessing an app. Existing users see this prompt again after app logic or connector updates.\u003c/p\u003e\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/consent.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eApp permissions consent pop-up\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\n\u003cp\u003eIn most scenarios, this pop-up can be bypassed.\u003c/p\u003e\n\u003ch2 id=\"hiding-consent-pop-up\"\u003eHiding consent pop-up\u003c/h2\u003e\n\u003cp\u003eThis requries a single PowerShell command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003eSet-AdminPowerAppApisToBypassConsent\u003c/span\u003e \u003cspan class=\"n\"\u003e-EnvironmentName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003e-AppName\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"no\"\u003eGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eExpected result:\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass_result.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \r\n \u003c/figure\u003e\r\n\n\u003cfigure\u003e\r\n     \u003cimg loading=\"lazy\" src=\"/images/bypass.png\"\r\n          alt=\"Power Apps Grant Consent\"/\u003e \u003cfigcaption\u003e\r\n             \u003cp\u003eBypassConsent flag is set\u003c/p\u003e\r\n         \u003c/figcaption\u003e\r\n \u003c/figure\u003e\r\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can get guids using PowerShell:\u003c/strong\u003e\u003c/p\u003e","title":"How to Get Rid of Power Apps Permissions Consent Form"},{"content":"Just a simple one-liner When you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\n1 2 3 4 5 Get-Content .\\rooms.txt | % { Write-Host \u0026#34;Working on $_\u0026#34; -ForegroundColor Cyan Add-MailboxFolderPermission -Identity \u0026#34;$($_.Trim()):\\Calendar\u0026#34; -User \u0026#34;przemek@contoso.com\u0026#34; -AccessRights Reviewer } Notes Text file we import via Get-Content contains a room email address per line .Trim is being used to remove blank spaces in TXT file - (\u0026rsquo; room@contoso.com\u0026rsquo; -\u0026gt; \u0026lsquo;room@contoso.com\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use In some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in Germany and \u0026ldquo;Calendier\u0026rdquo; for France) If permissions are already granted for an user, you need to either remove these and re-add or use Set-MailboxFolderPermissions ","permalink":"http://localhost:1313/posts/room_perm_bulk/","summary":"\u003ch2 id=\"just-a-simple-one-liner\"\u003eJust a simple one-liner\u003c/h2\u003e\n\u003cp\u003eWhen you have many room mailboxes, granting someone access to each room calendar one-by-one is painful. This one-liner reads a list of room SMTP addresses from a text file and applies the same permission to each mailbox calendar.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eGet-Content\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003erooms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003etxt\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eWrite-Host\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Working on \u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-ForegroundColor\u003c/span\u003e \u003cspan class=\"n\"\u003eCyan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eAdd-MailboxFolderPermission\u003c/span\u003e \u003cspan class=\"n\"\u003e-Identity\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eTrim\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\\Calendar\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-User\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;przemek@contoso.com\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003e-AccessRights\u003c/span\u003e \u003cspan class=\"n\"\u003eReviewer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"notes\"\u003eNotes\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eText file we import via \u003ccode\u003eGet-Content\u003c/code\u003e contains a room email address per line\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.Trim\u003c/code\u003e is being used to remove blank spaces in TXT file - (\u0026rsquo; \u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo; -\u0026gt; \u0026lsquo;\u003ca href=\"mailto:room@contoso.com\"\u003eroom@contoso.com\u003c/a\u003e\u0026rsquo;) - it\u0026rsquo;s just a safety feature I like to use\u003c/li\u003e\n\u003cli\u003eIn some tenants, the calendar folder name might be localized (for example \u0026ldquo;Kalendarz\u0026rdquo; in Poland, \u0026ldquo;Kalender\u0026rdquo; in  Germany and \u0026ldquo;Calendier\u0026rdquo; for France)\u003c/li\u003e\n\u003cli\u003eIf permissions are already granted for an user, you need to either remove these and re-add or use \u003ccode\u003eSet-MailboxFolderPermissions\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Assign Calendar Permissions in Bulk"},{"content":"The easy part Creating distribution lists in bulk is quite simple.\nJust a CSV file:\n1 2 3 4 name,mail Fancy Group,Fancy.Group@example.com Another Fancy Group,Another.Fancy.Group@example.com Not That Fancy Group,Not.That.Fancy.Group@example.com And for-each loop\n1 2 3 4 5 6 7 Import-Csv .\\groups.csv | ForEach-Object { New-DistributionGroup -Name $_.name -PrimarySmtpAddress $_.mail -OrganizationalUnit \u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39; -Type Security } Result:\nName DisplayName GroupType PrimarySmtpAddress Fancy Group Fancy Group Universal, SecurityEnabled Fancy.Group@example.com Another Fancy Group Another Fancy Group Universal, SecurityEnabled Another.Fancy.Group@example.com Not That Fancy Group Not That Fancy Group Universal, SecurityEnabled Not.That.Fancy.Group@example.com But updating msExchExtensionAttribute is different A below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\n1 Set-DistributionGroup -Identity \u0026#34;Fancy Group\u0026#34; -msExchExtensionAttribute20 \u0026#34;Lorem Ipsum\u0026#34; For this matter we must use Set-ADGroup but it accepts these for Identity parameter:\nA distinguished name A GUID (objectGUID) A security identifier (objectSid) A SAM account name (sAMAccountName) Since Active Directory adds random numbers to the sAMAccountName for uniqueness, we cannot reliably query by the DL \u0026ldquo;name\u0026rdquo;:\nExample: \u0026lsquo;Another Fancy Group\u0026rsquo; becomes \u0026lsquo;Another Fancy Group-1-292223989\u0026rsquo;\nA proper command, for the Another Fancy Group is:\n1 Set-ADGroup -Identity \u0026#39;Another Fancy Group-1-292223989\u0026#39; -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} We can also use filter and pipeline:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Replace @{msExchExtensionAttribute20=\u0026#34;Lorem Ipsum\u0026#34;} What about bulk update? For multiple groups, we can import a CSV file for data input, query objects by mail attribute and update these accordingly in loop.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #CSV file should contain \u0026#39;mail\u0026#39; header $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Replace @{msExchExtensionAttribute20 = \u0026#34;Lorem Ipsum\u0026#34;} Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 has been set\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } We can filter for any other property - as long as it\u0026rsquo;s uniqe (and covered in a CSV). Just update script\u0026rsquo;s line 7.\nClearing the Attribute To remove the value from msExchExtensionAttribute20:\nSingle group:\n1 2 Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;Another.Fancy.Group@example.com\u0026#39;\u0026#34; | Set-ADGroup -Clear msExchExtensionAttribute20 Bulk clear from CSV:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $groups = Import-Csv .\\groups.csv foreach ($g in $groups) { $group = Get-ADGroup -Filter \u0026#34;mail -eq \u0026#39;$($g.mail)\u0026#39;\u0026#34; -Properties mail if ($group) { Set-ADGroup -Identity $group.DistinguishedName -Clear msExchExtensionAttribute20 Write-Host \u0026#34;OK: $($g.mail) -\u0026gt; msExchExtensionAttribute20 cleared\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;ERROR: DL not found $($g.mail)\u0026#34; -ForegroundColor Red } } Summary This is a hybrid/on-premises scenario - less common now days, but still relevant for organizations running Exchange hybrid or syncing on-prem AD to Entra ID.\n","permalink":"http://localhost:1313/posts/msatt20/","summary":"\u003ch2 id=\"the-easy-part\"\u003eThe easy part\u003c/h2\u003e\n\u003cp\u003eCreating distribution lists in bulk is quite simple.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJust a CSV file:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-csv\" data-lang=\"csv\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eFancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eFancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAnother Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eAnother.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eNot That Fancy Group\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003eNot.That.Fancy.Group@example.com\u003c/span\u003e\u003cspan class=\"p\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eAnd for-each loop\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eImport-Csv\u003c/span\u003e \u003cspan class=\"p\"\u003e.\\\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ecsv\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003eForEach-Object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eNew-DistributionGroup\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Name\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003ename\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-PrimarySmtpAddress\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003email\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-OrganizationalUnit\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OU=Groups,DC=wrong,DC=went,DC=something,DC=dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003e-Type\u003c/span\u003e \u003cspan class=\"n\"\u003eSecurity\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eResult:\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eDisplayName\u003c/th\u003e\n          \u003cth\u003eGroupType\u003c/th\u003e\n          \u003cth\u003ePrimarySmtpAddress\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eFancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Fancy.Group@example.com\"\u003eFancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eAnother Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Another.Fancy.Group@example.com\"\u003eAnother.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eNot That Fancy Group\u003c/td\u003e\n          \u003ctd\u003eUniversal, SecurityEnabled\u003c/td\u003e\n          \u003ctd\u003e\u003ca href=\"mailto:Not.That.Fancy.Group@example.com\"\u003eNot.That.Fancy.Group@example.com\u003c/a\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"but-updating-msexchextensionattribute-is-different\"\u003eBut updating msExchExtensionAttribute is different\u003c/h2\u003e\n\u003cp\u003eA below won\u0026rsquo;t work as there is no such command under Set-DistributionGroup.\u003c/p\u003e","title":"Updating Distribution List Extended Attributes with PowerShell"},{"content":"Find me on:\nGitHub LinkedIn Mail: przemek@somethingwentwrong.dev Questions about a post?\nSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\nOr just write me an email.\n","permalink":"http://localhost:1313/contact/","summary":"\u003cp\u003eFind me on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/przemekokon\"\u003eGitHub\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.linkedin.com/in/przemek-okon\"\u003eLinkedIn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eMail: \u003ca href=\"mailto:przemek@somethingwentwrong.dev\"\u003eprzemek@somethingwentwrong.dev\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eQuestions about a post?\u003c/p\u003e\n\u003cp\u003eSee that \u0026ldquo;Suggest Changes\u0026rdquo; link at the bottom? That goes to GitHub - open an issue or PR.\u003c/p\u003e\n\u003cp\u003eOr just write me an email.\u003c/p\u003e","title":"Contact"}]